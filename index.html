<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>لعبة الرسم والتخمين</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --bg: #f4f4f9;
            --text: #333;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none; /* لمنع تحديد النص في الايباد */
        }
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .active {
            display: flex;
        }
        
        /* شاشة الإعدادات */
        input {
            padding: 15px;
            font-size: 20px;
            margin: 10px;
            border-radius: 10px;
            border: 2px solid #ccc;
            text-align: center;
        }
        button {
            padding: 15px 30px;
            font-size: 22px;
            margin: 10px;
            border-radius: 10px;
            border: none;
            background-color: var(--primary);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            touch-action: manipulation;
        }
        button:active { transform: scale(0.98); }
        
        /* لوحة التحكم */
        .scoreboard {
            display: flex;
            justify-content: space-around;
            width: 90%;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .team-score { font-size: 28px; font-weight: bold; text-align: center; }
        .turn-indicator { font-size: 30px; margin-bottom: 20px; color: var(--secondary); font-weight: bold; }
        .points-btn { font-size: 24px; width: 200px; margin: 10px; background-color: #ff9800; }
        
        /* شاشة اللعبة */
        .game-header {
            display: flex;
            justify-content: space-between;
            width: 95%;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
        }
        #timer { color: #f44336; font-size: 30px; }
        #canvas-container {
            width: 95%;
            height: 60vh;
            background: white;
            border: 3px solid #ccc;
            border-radius: 10px;
            position: relative;
        }
        
        /* إعدادات هامة جداً للرسم على الآيباد */
        canvas { 
            width: 100%; 
            height: 100%; 
            cursor: crosshair;
            touch-action: none; /* يمنع الشاشة من التحرك عند الرسم */
            display: block;
        }

        .tools {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        .color-btn {
            width: 45px; height: 45px; border-radius: 50%; border: 3px solid #fff; 
            box-shadow: 0 0 5px rgba(0,0,0,0.5); cursor: pointer;
        }
        .actions { margin-top: 15px; display: flex; gap: 10px; }
        .btn-correct { background-color: var(--primary); }
        .btn-wrong { background-color: #f44336; }
        
        /* إخفاء الكلمة */
        #word-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            z-index: 10;
        }
    </style>
</head>
<body>

    <div id="setup-screen" class="screen active">
        <h1>إعداد المسابقة</h1>
        <input type="text" id="team1-name" placeholder="اسم الفريق الأول" value="الفريق 1">
        <input type="text" id="team2-name" placeholder="اسم الفريق الثاني" value="الفريق 2">
        <button onclick="startGame()">ابدأ اللعب</button>
    </div>

    <div id="dashboard-screen" class="screen">
        <div class="scoreboard">
            <div class="team-score"><span id="t1-name-display"></span><br><span id="t1-score">0</span></div>
            <div class="team-score"><span id="t2-name-display"></span><br><span id="t2-score">0</span></div>
        </div>
        <div class="turn-indicator">دور: <span id="current-turn-name"></span></div>
        <h2>اختر فئة النقاط:</h2>
        <button class="points-btn" onclick="startRound(200)">200 نقطة (60 ثانية)</button>
        <button class="points-btn" onclick="startRound(400)">400 نقطة (50 ثانية)</button>
        <button class="points-btn" onclick="startRound(600)">600 نقطة (40 ثانية)</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="game-header">
            <div>الفريق: <span id="game-team"></span></div>
            <div id="timer">الوقت: <span>60</span></div>
            <div>النقاط: <span id="game-points"></span></div>
        </div>
        
        <div id="canvas-container">
            <div id="word-overlay">
                <p>الكلمة هي:</p>
                <h1 id="the-word" style="color: yellow; font-size: 80px;"></h1>
                <button onclick="startDrawingTimer()">بدأ الرسم (وإخفاء الكلمة)</button>
            </div>
            <canvas id="drawingBoard"></canvas>
        </div>

        <div class="tools">
            <div class="color-btn" style="background: black;" onclick="setColor('black')"></div>
            <div class="color-btn" style="background: red;" onclick="setColor('red')"></div>
            <div class="color-btn" style="background: green;" onclick="setColor('green')"></div>
            <div class="color-btn" style="background: blue;" onclick="setColor('blue')"></div>
            <div class="color-btn" style="background: yellow;" onclick="setColor('yellow')"></div>
            <button onclick="clearCanvas()" style="padding: 5px 15px; font-size: 16px; margin:0; background: #555;">مسح اللوحة</button>
        </div>

        <div class="actions" id="game-actions" style="display: none;">
            <button class="btn-correct" onclick="endRound(true)">إجابة صحيحة ✅</button>
            <button class="btn-wrong" onclick="endRound(false)">تخطي / لم يعرفوا ❌</button>
        </div>
        <div class="actions" id="timeup-actions" style="display: none;">
            <h2 style="color: red; margin: 10px;">انتهى الوقت!</h2>
            <button class="btn-wrong" onclick="showAnswerAndEnd()">إظهار الإجابة والعودة</button>
        </div>
    </div>

    <script>
        // --- البيانات الأساسية ---
        let teams = [{name: '', score: 0}, {name: '', score: 0}];
        let currentTeamIndex = 0;
        
        const words = {
            200: ['بيت'],
            400: ['سيارة', 'عنب'],
            600: ['لابتوب']
        };

        let currentWord = "";
        let currentPoints = 0;
        let timeLeft = 0;
        let timerInterval;
        let canDraw = false;

        // --- إعدادات الرسم للآيباد (Pointer Events) ---
        const canvas = document.getElementById('drawingBoard');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = 'black';
        
        // ضبط أبعاد السبورة لتتناسب مع الشاشة
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            // إعادة ضبط الفرشاة بعد تغيير الحجم
            ctx.lineWidth = 6;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = currentColor;
        }

        function getPointerPos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function startDrawing(e) {
            if (!canDraw) return;
            e.preventDefault();
            isDrawing = true;
            const pos = getPointerPos(e);
            lastX = pos.x;
            lastY = pos.y;
            
            // لرسم نقطة إذا تم النقر فقط بدون سحب
            ctx.beginPath();
            ctx.arc(lastX, lastY, ctx.lineWidth / 2, 0, Math.PI * 2);
            ctx.fillStyle = currentColor;
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }

        function draw(e) {
            if (!isDrawing || !canDraw) return;
            e.preventDefault();
            const pos = getPointerPos(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            
            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // استخدام Pointer Events وهي الأفضل للأجهزة اللمسية والآيباد
        canvas.addEventListener('pointerdown', startDrawing);
        canvas.addEventListener('pointermove', draw);
        canvas.addEventListener('pointerup', stopDrawing);
        canvas.addEventListener('pointercancel', stopDrawing);
        canvas.addEventListener('pointerout', stopDrawing);

        function setColor(color) { 
            currentColor = color;
            ctx.strokeStyle = currentColor; 
        }

        function clearCanvas() { 
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
        }

        // --- منطق اللعبة ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame() {
            teams[0].name = document.getElementById('team1-name').value || "الفريق 1";
            teams[1].name = document.getElementById('team2-name').value || "الفريق 2";
            updateDashboard();
            showScreen('dashboard-screen');
        }

        function updateDashboard() {
            document.getElementById('t1-name-display').innerText = teams[0].name;
            document.getElementById('t1-score').innerText = teams[0].score;
            document.getElementById('t2-name-display').innerText = teams[1].name;
            document.getElementById('t2-score').innerText = teams[1].score;
            document.getElementById('current-turn-name').innerText = teams[currentTeamIndex].name;
        }

        function startRound(points) {
            currentPoints = points;
            if(points === 200) timeLeft = 60;
            if(points === 400) timeLeft = 50;
            if(points === 600) timeLeft = 40;

            const wordList = words[points];
            currentWord = wordList[Math.floor(Math.random() * wordList.length)];

            document.getElementById('game-team').innerText = teams[currentTeamIndex].name;
            document.getElementById('game-points').innerText = points;
            document.getElementById('timer').querySelector('span').innerText = timeLeft;
            
            document.getElementById('the-word').innerText = currentWord;
            document.getElementById('word-overlay').style.display = 'flex';
            
            document.getElementById('game-actions').style.display = 'none';
            document.getElementById('timeup-actions').style.display = 'none';
            
            canDraw = false;
            showScreen('game-screen');
            
            // هام جداً: ضبط مقاس السبورة بعد ظهور الشاشة لضمان دقة الرسم
            setTimeout(resizeCanvas, 100);
            clearCanvas();
        }

        function startDrawingTimer() {
            document.getElementById('word-overlay').style.display = 'none';
            document.getElementById('game-actions').style.display = 'flex';
            canDraw = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').querySelector('span').innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        function timeUp() {
            canDraw = false;
            document.getElementById('game-actions').style.display = 'none';
            document.getElementById('timeup-actions').style.display = 'flex';
        }

        function showAnswerAndEnd() {
            alert("الإجابة كانت: " + currentWord);
            endRound(false);
        }

        function endRound(isCorrect) {
            clearInterval(timerInterval);
            canDraw = false;
            
            if (isCorrect) {
                teams[currentTeamIndex].score += currentPoints;
            }

            currentTeamIndex = currentTeamIndex === 0 ? 1 : 0;
            updateDashboard();
            showScreen('dashboard-screen');
        }
        
        // ضبط المقاسات عند تدوير الآيباد
        window.addEventListener('resize', () => {
            if(document.getElementById('game-screen').classList.contains('active')) {
                resizeCanvas();
            }
        });
    </script>
</body>
</html>
